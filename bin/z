#!/usr/bin/env coffee

peg = require 'pegjs'
fs = require 'fs'
{ d, l, err, time } = require '../lib/util'

grammar = fs.readFileSync './lib/z.pegjs', 'utf8'

parser = time 'Building parser.', ->
	parser = peg.buildParser grammar
	return parser

compile = (filename) ->
	try
		contents = fs.readFileSync(filename, 'utf8')
	catch e
		if e.code == 'ENOENT'
			return err "File not found: #{filename}"
		else
			return err e.toString()

	d "Contents of file #{filename}:\n#{contents}"
	parsed = parser.parse contents
	d 'Parsed: ' + parsed

for filename, i in process.argv
	if i >= 2
		compile filename

